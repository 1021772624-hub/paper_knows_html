/**
 * ADVANCED-ANALYSIS-MODAL.JS - è®ºæ–‡ AI æ·±åº¦ç†è§£å·¥ä½œå°
 * èŒè´£ï¼šå±•ç¤ºå®Œæ•´çš„ AI åˆ†æç»“æœï¼ŒåŒ…å«æ–‡çŒ®æ·±åº¦è§£æå’Œå®éªŒæ–¹æ¡ˆä¸¤ä¸ªæ ‡ç­¾é¡µ
 */

// æ¸²æŸ“é«˜çº§åˆ†ææ¨¡æ€æ¡†
function renderAdvancedAnalysisModal(paperId, analysis, fromCache = false) {
  // åˆ›å»ºæˆ–è·å–æ¨¡æ€æ¡†
  let modal = document.getElementById('advanced-analysis-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'advanced-analysis-modal';
    modal.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 1200px;
      height: 90vh;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      z-index: 1000;
      display: flex;
      flex-direction: column;
    `;
    document.body.appendChild(modal);

    // æ·»åŠ é®ç½©å±‚
    const overlay = document.createElement('div');
    overlay.id = 'advanced-analysis-overlay';
    overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 999;';
    overlay.onclick = () => closeAdvancedAnalysisModal();
    document.body.appendChild(overlay);
  }

  // æ¸²æŸ“æ¨¡æ€æ¡†å†…å®¹
  modal.innerHTML = `
    <div style="padding: 1.5rem 2rem; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h2 style="margin: 0; font-size: 1.5rem; color: #2c3e50;">ğŸ¤– AI æ·±åº¦è§£è¯»</h2>
        <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #7f8c8d;">
          ${fromCache ? 'ğŸ“¦ æ¥è‡ªç¼“å­˜' : 'âœ¨ æœ€æ–°åˆ†æ'} |
          åˆ†ææ—¶é—´: ${new Date(analysis.ai_meta.analysis_time).toLocaleString()} |
          ç½®ä¿¡åº¦: ${analysis.ai_meta.confidence}
        </p>
      </div>
      <button onclick="closeAdvancedAnalysisModal()" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #95a5a6;">Ã—</button>
    </div>

    <div style="display: flex; border-bottom: 1px solid #e0e0e0; padding: 0 2rem; background: #f8f9fa; align-items: center; justify-content: space-between;">
      <div style="display: flex;">
        <button class="tab-btn active" data-tab="deep-analysis" onclick="switchTab('deep-analysis')" style="padding: 1rem 1.5rem; border: none; background: none; cursor: pointer; border-bottom: 3px solid #3498db; font-weight: 600; color: #2c3e50;">
          ğŸ“š æ–‡çŒ®æ·±åº¦è§£æ
        </button>
        <button class="tab-btn" data-tab="experiment-plan" onclick="switchTab('experiment-plan')" style="padding: 1rem 1.5rem; border: none; background: none; cursor: pointer; border-bottom: 3px solid transparent; color: #7f8c8d;">
          ğŸ”¬ å®éªŒæ–¹æ¡ˆ
        </button>
      </div>
      <div style="display: flex; gap: 0.5rem;">
        <button onclick="viewPDF(${paperId})" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
          ğŸ“„ æŸ¥çœ‹ PDF
        </button>
        <button onclick="reanalyzePaper(${paperId})" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
          ğŸ”„ é‡æ–°åˆ†æ
        </button>
      </div>
    </div>

    <div style="flex: 1; overflow-y: auto; padding: 2rem;">
      <div id="tab-deep-analysis" class="tab-content active">
        ${renderDeepAnalysisTab(analysis)}
      </div>
      <div id="tab-experiment-plan" class="tab-content" style="display: none;">
        ${renderExperimentPlanTab(analysis)}
      </div>
    </div>
  `;
}

// æ¸²æŸ“æ–‡çŒ®æ·±åº¦è§£ææ ‡ç­¾é¡µ
function renderDeepAnalysisTab(analysis) {
  const basic = analysis.basic_info || {};
  const background = analysis.background_and_problem || {};
  const objectives = analysis.research_objectives || {};
  const methodology = analysis.methodology || {};
  const results = analysis.key_results || {};
  const innovation = analysis.innovation_analysis || {};
  const limitations = analysis.limitations || {};

  return `
    <!-- 1. è®ºæ–‡åŸºæœ¬ä¿¡æ¯ -->
    <section style="margin-bottom: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
      <h3 style="color: #2c3e50; margin-top: 0; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem;">
        ğŸ“„ è®ºæ–‡åŸºæœ¬ä¿¡æ¯
      </h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
        <div><strong>æ ‡é¢˜ï¼š</strong>${basic.title || 'æœªçŸ¥'}</div>
        <div><strong>ä½œè€…ï¼š</strong>${basic.authors || 'æœªçŸ¥'}</div>
        <div><strong>æœŸåˆŠï¼š</strong>${basic.journal || 'æœªçŸ¥'}</div>
        <div><strong>å‡ºç‰ˆç¤¾ï¼š</strong>${basic.publisher || 'æœªçŸ¥'}</div>
        <div><strong>å‘è¡¨æ—¶é—´ï¼š</strong>${basic.publish_date || 'æœªçŸ¥'}</div>
        <div><strong>DOIï¼š</strong>${basic.doi || 'æœªçŸ¥'}</div>
        <div><strong>åˆ†ç±»ï¼š</strong><span class="badge badge-info">${basic.category || 'æœªçŸ¥'}</span></div>
        <div><strong>å…³é”®è¯ï¼š</strong>${(basic.keywords || []).map(k => `<span class="badge badge-secondary" style="margin-right: 0.5rem;">${k}</span>`).join('')}</div>
      </div>
    </section>

    <!-- 2. ç ”ç©¶èƒŒæ™¯ä¸é—®é¢˜å®šä¹‰ -->
    <section style="margin-bottom: 2rem;">
      <h3 style="color: #2c3e50; border-bottom: 2px solid #e74c3c; padding-bottom: 0.5rem;">
        ğŸ¯ ç ”ç©¶èƒŒæ™¯ä¸é—®é¢˜å®šä¹‰
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>ç ”ç©¶èƒŒæ™¯ï¼š</strong><br>${background.research_background || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>é¢†åŸŸç—›ç‚¹ï¼š</strong><br>${background.field_pain_points || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>ç°æœ‰æ–¹æ³•ä¸è¶³ï¼š</strong><br>${background.existing_methods_limitations || 'æš‚æ— æ•°æ®'}</p>
      </div>
    </section>

    <!-- 3. ç ”ç©¶ç›®æ ‡ -->
    <section style="margin-bottom: 2rem;">
      <h3 style="color: #2c3e50; border-bottom: 2px solid #9b59b6; padding-bottom: 0.5rem;">
        ğŸ“ ç ”ç©¶ç›®æ ‡
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>æ ¸å¿ƒç ”ç©¶é—®é¢˜ï¼š</strong><br>${objectives.core_research_question || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>é€‚ç”¨èŒƒå›´è¯´æ˜ï¼š</strong><br>${objectives.scope_description || 'æš‚æ— æ•°æ®'}</p>
      </div>
    </section>

    <!-- 4. æŠ€æœ¯è·¯çº¿/æ–¹æ³•è®ºæ‹†è§£ -->
    <section style="margin-bottom: 2rem;">
      <h3 style="color: #2c3e50; border-bottom: 2px solid #f39c12; padding-bottom: 0.5rem;">
        ğŸ”§ æŠ€æœ¯è·¯çº¿/æ–¹æ³•è®ºæ‹†è§£
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>æ•´ä½“ç ”ç©¶æµç¨‹ï¼š</strong><br>${methodology.overall_workflow || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>å®éªŒè®¾è®¡é€»è¾‘ï¼š</strong><br>${methodology.experimental_design_logic || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>å…³é”®æŠ€æœ¯ï¼š</strong><br>${(methodology.key_techniques || []).map(t => `â€¢ ${t}`).join('<br>')}</p>
        <p><strong>è¡¨å¾æ–¹æ³•ï¼š</strong><br>${(methodology.characterization_methods || []).map(m => `â€¢ ${m}`).join('<br>')}</p>
      </div>
    </section>

    <!-- 5. æ ¸å¿ƒç»“æœæ€»ç»“ -->
    <section style="margin-bottom: 2rem;">
      <h3 style="color: #2c3e50; border-bottom: 2px solid #27ae60; padding-bottom: 0.5rem;">
        ğŸ“Š æ ¸å¿ƒç»“æœæ€»ç»“
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>å…³é”®å®éªŒç»“æœï¼š</strong><br>${results.main_findings || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>æ•°æ®è¶‹åŠ¿è§£è¯»ï¼š</strong><br>${results.data_trends || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>æ”¯æ’‘ç»“è®ºçš„è¯æ®ï¼š</strong><br>${results.supporting_evidence || 'æš‚æ— æ•°æ®'}</p>
      </div>
    </section>

    <!-- 6. åˆ›æ–°ç‚¹åˆ†æ -->
    <section style="margin-bottom: 2rem; padding: 1.5rem; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
      <h3 style="color: #2c3e50; margin-top: 0; border-bottom: 2px solid #ffc107; padding-bottom: 0.5rem;">
        ğŸ’¡ åˆ›æ–°ç‚¹åˆ†æ
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>æ–¹æ³•åˆ›æ–°ï¼š</strong><br>${innovation.method_innovation || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>æœºç†åˆ›æ–°ï¼š</strong><br>${innovation.mechanism_innovation || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>å·¥ç¨‹/åº”ç”¨åˆ›æ–°ï¼š</strong><br>${innovation.application_innovation || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>ä¸å‰äººå·¥ä½œçš„å·®å¼‚ï¼š</strong><br>${innovation.difference_from_prior_work || 'æš‚æ— æ•°æ®'}</p>
      </div>
    </section>

    <!-- 7. å±€é™æ€§ä¸æœªè§£å†³é—®é¢˜ -->
    <section style="margin-bottom: 2rem; padding: 1.5rem; background: #f8d7da; border-radius: 8px; border-left: 4px solid #dc3545;">
      <h3 style="color: #2c3e50; margin-top: 0; border-bottom: 2px solid #dc3545; padding-bottom: 0.5rem;">
        âš ï¸ å±€é™æ€§ä¸æœªè§£å†³é—®é¢˜
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>ä½œè€…æ‰¿è®¤çš„é™åˆ¶ï¼š</strong><br>${limitations.author_acknowledged || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>AI æ¨æ–­çš„æ½œåœ¨é£é™©ç‚¹ï¼š</strong><br>${limitations.ai_inferred_risks || 'æš‚æ— æ•°æ®'}</p>
      </div>
    </section>
  `;
}

// æ¸²æŸ“å®éªŒæ–¹æ¡ˆæ ‡ç­¾é¡µ
function renderExperimentPlanTab(analysis) {
  const replication = analysis.experiment_replication || {};
  const extension = analysis.experiment_extension || {};
  const comparative = analysis.comparative_analysis || {};
  const risks = analysis.risks_and_warnings || {};

  return `
    <!-- 1. å®éªŒå¤ç°æ–¹æ¡ˆ -->
    <section style="margin-bottom: 2rem; padding: 1.5rem; background: #d1ecf1; border-radius: 8px; border-left: 4px solid #17a2b8;">
      <h3 style="color: #2c3e50; margin-top: 0; border-bottom: 2px solid #17a2b8; padding-bottom: 0.5rem;">
        ğŸ”¬ å®éªŒå¤ç°æ–¹æ¡ˆ
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>ææ–™å‡†å¤‡ï¼š</strong><br>${replication.materials_preparation || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>å·¥è‰ºå‚æ•°ï¼š</strong><br>${replication.process_parameters || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>è¡¨å¾æ–¹æ³•ï¼š</strong><br>${replication.characterization_methods || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>è¯„ä»·æŒ‡æ ‡ï¼š</strong><br>${replication.evaluation_metrics || 'æš‚æ— æ•°æ®'}</p>
        <div style="margin-top: 1rem;">
          <strong>å¤ç°æ­¥éª¤ï¼š</strong>
          <ol style="margin-top: 0.5rem;">
            ${(replication.step_by_step_guide || []).map(step => `<li>${step}</li>`).join('')}
          </ol>
        </div>
      </div>
    </section>

    <!-- 2. æ‰©å±•å®éªŒå»ºè®® -->
    <section style="margin-bottom: 2rem;">
      <h3 style="color: #2c3e50; border-bottom: 2px solid #28a745; padding-bottom: 0.5rem;">
        ğŸš€ æ‰©å±•å®éªŒå»ºè®®
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>å‚æ•°ä¼˜åŒ–å»ºè®®ï¼š</strong><br>${extension.parameter_optimization || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>ææ–™ä½“ç³»è¿ç§»æ–¹æ¡ˆï¼š</strong><br>${extension.material_system_transfer || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>æ›¿ä»£å·¥è‰ºè·¯çº¿ï¼š</strong><br>${extension.alternative_routes || 'æš‚æ— æ•°æ®'}</p>
      </div>
    </section>

    <!-- 3. æ¨ªå‘å¯¹æ¯”åˆ†æ -->
    <section style="margin-bottom: 2rem; padding: 1.5rem; background: #e2e3e5; border-radius: 8px;">
      <h3 style="color: #2c3e50; margin-top: 0; border-bottom: 2px solid #6c757d; padding-bottom: 0.5rem;">
        ğŸ“Š æ¨ªå‘å¯¹æ¯”åˆ†æ
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <p><strong>ä¸ç›¸ä¼¼æ–‡çŒ®çš„å®éªŒæ¡ä»¶å¯¹æ¯”ï¼š</strong><br>${comparative.similar_works_comparison || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>æ€§èƒ½ä¸æˆæœ¬å¯¹æ¯”ï¼š</strong><br>${comparative.performance_cost_comparison || 'æš‚æ— æ•°æ®'}</p>
        <p><strong>é€‚ç”¨åœºæ™¯å¯¹æ¯”ï¼š</strong><br>${comparative.application_scenarios || 'æš‚æ— æ•°æ®'}</p>
      </div>
    </section>

    <!-- 4. é£é™©ä¸å¤±è´¥ç‚¹æç¤º -->
    <section style="margin-bottom: 2rem; padding: 1.5rem; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
      <h3 style="color: #2c3e50; margin-top: 0; border-bottom: 2px solid #ffc107; padding-bottom: 0.5rem;">
        âš ï¸ é£é™©ä¸å¤±è´¥ç‚¹æç¤º
      </h3>
      <div style="margin-top: 1rem; line-height: 1.8; color: #555;">
        <div style="margin-bottom: 1rem;">
          <strong>æ˜“å¤±è´¥æ­¥éª¤ï¼š</strong>
          <ul style="margin-top: 0.5rem;">
            ${(risks.failure_prone_steps || []).map(step => `<li style="color: #dc3545;">${step}</li>`).join('')}
          </ul>
        </div>
        <div style="margin-bottom: 1rem;">
          <strong>å®éªŒæ³¨æ„äº‹é¡¹ï¼š</strong>
          <ul style="margin-top: 0.5rem;">
            ${(risks.experimental_precautions || []).map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        <div>
          <strong>æ–°æ‰‹è­¦å‘Šï¼š</strong>
          <ul style="margin-top: 0.5rem;">
            ${(risks.beginner_warnings || []).map(warning => `<li style="color: #fd7e14;">${warning}</li>`).join('')}
          </ul>
        </div>
      </div>
    </section>
  `;
}

// åˆ‡æ¢æ ‡ç­¾é¡µ
function switchTab(tabName) {
  // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
  document.querySelectorAll('.tab-btn').forEach(btn => {
    if (btn.dataset.tab === tabName) {
      btn.classList.add('active');
      btn.style.borderBottom = '3px solid #3498db';
      btn.style.color = '#2c3e50';
      btn.style.fontWeight = '600';
    } else {
      btn.classList.remove('active');
      btn.style.borderBottom = '3px solid transparent';
      btn.style.color = '#7f8c8d';
      btn.style.fontWeight = 'normal';
    }
  });

  // æ›´æ–°å†…å®¹æ˜¾ç¤º
  document.querySelectorAll('.tab-content').forEach(content => {
    if (content.id === `tab-${tabName}`) {
      content.style.display = 'block';
    } else {
      content.style.display = 'none';
    }
  });
}

// é‡æ–°åˆ†æ
async function reanalyzePaper(paperId) {
  if (!confirm('ç¡®å®šè¦é‡æ–°åˆ†æè¿™ç¯‡æ–‡çŒ®å—ï¼Ÿ\n\nè¿™å°†è¦†ç›–ç°æœ‰çš„åˆ†æç»“æœã€‚')) {
    return;
  }

  const modal = document.getElementById('advanced-analysis-modal');
  modal.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column;"><h3>ğŸ¤– æ­£åœ¨é‡æ–°åˆ†æ...</h3><p>è¯·ç¨å€™ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´</p></div>';

  try {
    const response = await fetch(`${API_BASE_URL}/api/papers/${paperId}/analyze?force_reanalyze=true`, {
      method: 'POST'
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const result = await response.json();
    renderAdvancedAnalysisModal(paperId, result.analysis, false);

    // é‡æ–°åŠ è½½æ–‡çŒ®åˆ—è¡¨
    if (typeof loadPapers === 'function') {
      await loadPapers();
    }
  } catch (error) {
    console.error('é‡æ–°åˆ†æå¤±è´¥:', error);
    modal.innerHTML = `
      <div style="display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column;">
        <h3 style="color: #e74c3c;">âŒ é‡æ–°åˆ†æå¤±è´¥</h3>
        <p>${error.message}</p>
        <button onclick="closeAdvancedAnalysisModal()" class="btn btn-primary">å…³é—­</button>
      </div>
    `;
  }
}

// å…³é—­æ¨¡æ€æ¡†
function closeAdvancedAnalysisModal() {
  const modal = document.getElementById('advanced-analysis-modal');
  const overlay = document.getElementById('advanced-analysis-overlay');
  if (modal) modal.remove();
  if (overlay) overlay.remove();
}

// æ‰“å¼€é«˜çº§åˆ†ææ¨¡æ€æ¡†ï¼ˆä¸»å…¥å£å‡½æ•°ï¼‰
async function openAdvancedAnalysisModal(paperId, forceReanalyze = false) {
  // åˆ›å»ºä¸´æ—¶ loading æ¨¡æ€æ¡†
  let modal = document.getElementById('advanced-analysis-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'advanced-analysis-modal';
    modal.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 1200px;
      height: 90vh;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    `;
    document.body.appendChild(modal);

    // æ·»åŠ é®ç½©å±‚
    const overlay = document.createElement('div');
    overlay.id = 'advanced-analysis-overlay';
    overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 999;';
    overlay.onclick = () => closeAdvancedAnalysisModal();
    document.body.appendChild(overlay);
  }

  modal.innerHTML = '<h3>ğŸ¤– åŠ è½½åˆ†æç»“æœ...</h3><p>è¯·ç¨å€™</p>';

  try {
    const url = forceReanalyze
      ? `${API_BASE_URL}/api/papers/${paperId}/analyze?force_reanalyze=true`
      : `${API_BASE_URL}/api/papers/${paperId}/analyze`;

    const response = await fetch(url, { method: 'POST' });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const result = await response.json();
    renderAdvancedAnalysisModal(paperId, result.analysis, result.from_cache);

    // é‡æ–°åŠ è½½æ–‡çŒ®åˆ—è¡¨
    if (typeof loadPapers === 'function') {
      await loadPapers();
    }
  } catch (error) {
    console.error('åŠ è½½åˆ†æç»“æœå¤±è´¥:', error);
    modal.innerHTML = `
      <div style="text-align: center;">
        <h3 style="color: #e74c3c;">âŒ åŠ è½½å¤±è´¥</h3>
        <p>${error.message}</p>
        <button onclick="closeAdvancedAnalysisModal()" class="btn btn-primary">å…³é—­</button>
      </div>
    `;
  }
}


// é‡æ–°åˆ†ææ–‡çŒ®
async function reanalyzePaper(paperId) {
  if (!confirm('ç¡®å®šè¦é‡æ–°åˆ†æè¿™ç¯‡æ–‡çŒ®å—ï¼Ÿ\n\nè¿™å°†ä½¿ç”¨ AI é‡æ–°è§£æ PDF å†…å®¹ã€‚')) {
    return;
  }

  closeAdvancedAnalysisModal();

  // ä½¿ç”¨é˜Ÿåˆ—ç³»ç»Ÿè¿›è¡Œé‡æ–°åˆ†æ
  if (typeof startQueueAnalysis === 'function') {
    await startQueueAnalysis([paperId]);
  } else {
    alert('åˆ†æç³»ç»Ÿæœªå°±ç»ªï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•');
  }
}
